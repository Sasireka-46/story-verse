const stories = [
  {
  id: 1,
  title: "The Sleepy Moon",
  text: `Once upon a time, high up in the sky, the Moon began to feel very sleepy. "I think I'll take a nap early tonight," the Moon yawned, curling into a crescent. But just as she closed her silvery eyes, the stars sparkled in protest.

"Wait! Donâ€™t sleep yet!" they twinkled. "You shine so brightâ€”we canâ€™t sleep without your glow!"
The Moon blinked slowly and smiled. "But Iâ€™m soooo sleepy," she murmured.
The stars giggled and began to dance around her. "Weâ€™ll sing you a lullaby if you stay up just a little longer," they chimed together.
So, the Moon stayed awake, glowing gently as the stars hummed their lullaby. Down on Earth, children curled up in beds, wrapped in dreams as soft as stardust.

When the last light on Earth flickered out, the Moon gave one last sleepy yawn and tucked herself behind a cozy cloud. From that night on, she always waited to be the last light to dimâ€”making sure everyone felt safe and sleepy under her quiet, glowing watch.

High above the whispering trees and still lakes, the Moon floated quietly through the night sky. She had been awake for thousands of nightsâ€”watching over dreamers, glowing for night owls, and guiding tiny fireflies as they danced through meadows. But tonight felt different.

"I'm so very sleepy," sighed the Moon, curling into a soft crescent. Her silvery beams dimmed ever so slightly, like a candle flickering before it rests.

The stars, all glittering like diamonds on a velvet curtain, gasped in twinkling surprise.

"Sleepy?" whispered the North Star.
"But who will watch the oceans sway?" asked a little comet.
"And what about the owls and wolves? They sing only when you shine!" cried a cluster of stardust.

The Moon blinked lazily and gave a gentle chuckle. "Iâ€™ve been glowing forever. Just one night off wouldnâ€™t hurt... would it?"

But below, on Earth, children were peeking out from their bedroom windows. They looked up at the sky, searching for her calming light. One little girl whispered, "Goodnight, Moon. Please donâ€™t go away."

Hearing her, the Moonâ€™s heart softened. She sighed againâ€”not out of tiredness, but out of love.

"Maybe... just a few more minutes," she decided.

The stars, overjoyed, began to hum a gentle lullaby just for her:

âœ¨ "Glow on, gentle guardian, above the sleepy land,
Guide the dreams of every child, with your silver hand..." âœ¨

The Moon beamed quietly, bathing rooftops, forests, and seas in her soft glow. She lit up the paths of travelers, watched over sleepy bears in their dens, and even reflected in the sleepy eyes of a kitten curled in a windowsill.

As the night stretched on, clouds drifted in like cozy blankets. The Moon knew the time had come. Her eyelids fluttered like wings of a resting butterfly.

With one final yawn, she whispered, â€œGoodnight, my stars. Thank you for keeping me company.â€

She slipped behind a plush cloud, her light fading gently like a bedtime story's last page. The stars twinkled quietly, their lullaby fading into silence.

And somewhere below, a child whispered, "Sweet dreams, Moon."

From that night on, the Moon never truly slept. She simply rested in shiftsâ€”sometimes bright and bold, sometimes a quiet crescent. But she always made sure the night never felt too dark.

Because even the Moon, in all her glowing glory, needed the comfort of being lovedâ€”and the magic of a lullaby.

The next night, the Moon rose again, this time a soft crescent tucked in a blanket of stars. She had rested just enoughâ€”not to shine the brightest, but enough to feel seen.

The stars, who had kept watch while she drifted in and out of slumber, felt proud. "You looked peaceful," one whispered.
The Moon smiled. "I dreamt of oceans that whispered lullabies, and trees that told bedtime stories."

Down on Earth, the children noticed her softer glow. â€œSheâ€™s sleepy,â€ they said. â€œLetâ€™s be quiet and let her rest.â€

So the towns dimmed their lights early. Parents read stories in hushed tones. Cats curled beside windowpanes. The world moved a little slowerâ€”for her.

And the Moon noticed.

She saw the kindness below. A bear tucking its cubs in a hollow log. A lighthouse keeper blinking his lantern just once, as if to say â€œI see you.â€ Even the waves slowed their crashing rhythm, swaying gently under her sleepy watch.

For the first time, the Moon realized something important. She didnâ€™t always have to be perfect, or bright, or fully awake. Even just being there was enough.

And in return, the world promised to notice herâ€”even when she was hidden behind clouds, or just a sliver of herself.

So, sometimes she yawned. Sometimes she dozed. But she always came back, and when she did, the stars would welcome her like an old friend, and the children would whisper, "There you are."

And up there in the sky, curled like a comma in the middle of the night, the Moon would shine just a little brighter. Not from dutyâ€”but from love.`,
  category: "Fantasy",
  image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ-ff7dPX3JIoJDy5vLrJeZ0gQn1Tp2_aFgFA&s"
},

  {
  id: 2,
  title: "The Lost Button",
  text: `In a drawer stuffed with yarn, pins, and forgotten socks lived a tiny pink button. She was round, shiny, and just a little chipped. But most of allâ€”she was lonely.

â€œI used to belong to someone,â€ she whispered to a spool of thread. â€œI kept a coat closed on chilly days.â€

The spool, who had grown dusty with time, mumbled back sleepily, â€œA noble job, little one.â€

The other buttons in the drawer had long stopped chatting. Some were still stuck together on cardboard, others had lost their shine. The drawer opened sometimes, but no one ever picked her. She waitedâ€”day after day, year after yearâ€”hoping to feel needed again.

One morning, after what felt like forever, the drawer creaked open. The light spilled in like golden syrup. A small hand rummaged through the clutter, pausingâ€¦ then picked up the pink button.

â€œHmm,â€ said a little girl, holding the button to the sunlight. â€œYouâ€™re perfect.â€

The button blinked in surprise. Perfect?

The girl skipped over to her teddy bearâ€”fluffy, worn, and missing a button where his heart should be. â€œWeâ€™ll fix you,â€ she said kindly. â€œThis will be your heart.â€

She took out a needle and thread and began to sew with gentle care. The button felt a small tug, then a pinch, and suddenlyâ€”she was stitched tightly onto the teddy bearâ€™s chest.

A warm glow filled the buttonâ€™s round belly. She could hear the bearâ€™s soft cotton stuffing rustle as he was picked up and hugged tightly. She wasnâ€™t just a button anymore. She was his heart.

That night, the teddy bear was tucked in beside the little girl. As the room dimmed and the stars blinked awake, the button gleamed softly in the moonlight.

â€œIâ€™m home,â€ she whispered.

---

Days turned into weeks.

The teddy bear and the button became part of every momentâ€”tea parties in the garden, naps under sunlit windows, and long car rides with strawberry-sticky fingers wrapped around them.

The button listened to bedtime stories and quiet lullabies. She heard the girlâ€™s dreams whispered into the pillow and felt every giggle and tear soaked into the teddyâ€™s soft fur.

One stormy night, thunder rattled the windows. The little girl pulled the bear tightly to her chest. â€œDonâ€™t be scared,â€ she whisperedâ€”not to the bear, but to herself.

The button shimmered. She wasnâ€™t afraid. She was brave now. She was love sewn into cloth.

When the girl outgrew dolls and tea sets, the bear was gently placed on a shelfâ€”but never forgotten. Years passed, but the button never dulled. Her purpose never faded.

And one day, the drawer opened againâ€”this time by a new pair of hands. A tiny child looked up and reached for the teddy with wide eyes.

â€œMine?â€ they asked.

The grown-up girlâ€”now a motherâ€”smiled. â€œHeâ€™s been waiting for you.â€

The teddy was hugged once again. The button glowed once more.

And as the stars rose outside the window, the button whispered, â€œStill home.â€`,
  category: "Friendship",
  image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRbm1m1aW4vcN1XTIdFupYtNVcg6wX3tEf2_g&s"
},

  {
  id: 3,
  title: "Kitty and the Rain",
  text: `Once, in a quiet little town with cobbled streets and blooming flower pots on windowsills, lived a tiny gray kitten named Miu. Miu was soft as a cloud, with big blue eyes that reflected the sky. But there was one thing Miu absolutely couldnâ€™t standâ€”the rain.

Every time dark clouds gathered and drops began to fall, Miu would scramble under the couch or curl up in a corner, her ears twitching at every splash against the window. She hated the wetness, the noise, and how her fluffy fur would droop like a soaked mop.

â€œWhy does the sky cry so much?â€ she often meowed to herself.

One day, the rain came suddenly. The clouds rolled in like sleepy giants, and the sky darkened. Miu had just finished her nap on the windowsill when the first droplet landed on her nose. â€œYuck!â€ she hissed and darted under the bed.

But something was different that day. The window had been left open just a crack, and a soft, earthy scent drifted inâ€”petrichor, the smell of the world breathing under rain.

Curious, Miu crept back up and peeked outside. The garden sparkled with raindrops. Leaves danced. Petals swayed. Puddles glimmered like glassy mirrors. And then she saw itâ€”her reflection.

There she was, looking back at herself in the puddle below. Her fur damp, her eyes wide. She reached out a paw, and the water rippled with laughter.

Miu blinked. Something inside her stirred.

With one brave hop, she leapt down from the windowsill and padded out the door. Rain kissed her fur. She flinched at firstâ€”but then, she danced.

She pounced into puddles. She swatted at raindrops falling from the eaves. She rolled in the wet grass and chased her reflection like it was a friend she never knew she had.

As the drizzle fell softly, Miu trotted through the garden, her little paws leaving prints in the muddy earth. The raindrops painted her fur with silver threads, but she didnâ€™t care anymore. The world felt differentâ€”magical, even.

She paused at a daisy that drooped under the weight of a raindrop and gave it a gentle boop with her nose. The drop rolled off and landed with a tiny splash. Miu giggled, or as much as a kitten could giggle, and whispered, â€œThere you go, little flower.â€

From behind the garden gate, an old brown dog named Rufus watched her with sleepy eyes. â€œYou like the rain now?â€ he barked with surprise.

â€œI think I do,â€ Miu meowed, tilting her head. â€œItâ€™s not so scary when you play with it.â€

The sky let out a low, rumbling purrâ€”thunder. Miu flinched for just a moment, but Rufus padded over and stood beside her. â€œItâ€™s just the clouds stretching,â€ he said. â€œEven the sky gets stiff sometimes.â€

That made Miu smile.

Suddenly, a strong gust of wind whooshed by, sending leaves twirling like dancers. Miu chased them gleefully, her tail swishing like a banner in the wind. She leapt and twirled, landing with tiny splashes in the puddles that had become her playground.

Later that afternoon, as the rain softened to a drizzle, Miu sat quietly beneath the garden bench. Her whiskers twitched with raindrops, and her eyes gazed up at the sky.

"I used to think rain was cold and lonely," she thought, "but it's really just the sky giving everything a soft hug."

The garden shimmered. Earthworms peeked from the soil. A robin landed nearby and shook its feathers dry. Everything seemed more alive after the rain.

When Miu finally returned home, soaked and happy, she curled up on the warm windowsill. Her owner, a little girl with a wool sweater and pink rain boots, wrapped her in a fluffy towel and whispered, â€œDid you have fun in the rain, my little cloud?â€

Miu purred deeply, eyes fluttering closed.

From that day on, whenever it rained, Miu didnâ€™t hide. She welcomed it like an old friendâ€”with open paws and a curious heart. And every child who saw her playing outside thought, â€œIf Kitty can love the rainâ€¦ maybe I can too.â€`,
  category: "Animals",
  image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSCGR5q-vFeDdgt4aZ5WBoCURD4N8OBLPd68Q&s"
},

  {
  id: 4,
  title: "The Magic Teacup",
  text: `In the corner of a crooked little cottage, nestled between ivy-covered windows and shelves full of dusty books, sat an old wooden cabinet. Inside it lived a porcelain teacupâ€”faded, delicate, and forgotten.

The cup once held afternoon tea during warm garden parties, but now it sat quietly, its once-bright pink roses on the rim barely visible through layers of dust. No one had used it in yearsâ€¦ until a curious little girl named Elsie came to stay with her grandmother for the summer.

While helping her grandmother clean the old kitchen, Elsie spotted the cup.

â€œGrandma, look! This teacup is so pretty.â€

Her grandmother leaned in and gave a knowing smile. â€œThat,â€ she said gently, â€œis a magic teacup.â€

Elsie blinked. â€œMagic?â€

Her grandmother nodded. â€œThey say if you pour warm tea into it while the garden is in bloom, it will whisper the secrets of the flowers and the wind.â€

Elsieâ€™s eyes sparkled. That evening, with chamomile flowers plucked from the garden and a spoonful of honey, she brewed a tiny pot of tea and poured it into the old teacup.

At firstâ€”nothing.

Then, the steam began to curl and shimmer. The cup trembled softly, and a hush filled the kitchen. Elsie leaned closer.

And then she heard it.

A whisperâ€”gentle, like a breeze in spring:
ðŸ«– â€œThe daisies are dreaming of sunshine. The roses are laughing at the bees. And the robins? They've hidden a treasure under the big willow treeâ€¦â€

Wide-eyed, Elsie rushed to the garden, past marigolds and snapdragons, until she reached the willow. She dug carefullyâ€”and there, beneath the roots, was a tiny tin box with a rusted clasp. Inside was a locketâ€¦ shaped like a teacup, with a faded photograph tucked inside.

From that day on, the teacup whispered many things.

It told stories of sleepy mushrooms that glowed beneath the moonlight. Of earthworms that wrote love poems in the soil. Of the lilac tree that remembered lullabies from decades ago.

But the teacup only whispered if the tea was made with care. One day, Elsie rushed and spilled a bit of water. The cup stayed quietâ€”silent and still. She learned then: the magic needed patience.

As the summers passed, Elsie grew. The teacup became her closest friend. With every secret it shared, she fell more in love with the quiet wonder of the garden.

Years later, Elsie returned to the cottage as a grown woman. She dusted off the shelf and lifted the cup with a fond smile. â€œItâ€™s time for someone new to hear your stories,â€ she said.

And with that, she placed it gently in the window, where the sun could kiss its rim, waiting for another pair of curious handsâ€¦ and a heart ready to listen.

If you ever find yourself in a cottage where the flowers bloom brighter than they should, and the wind seems to hum a tuneâ€”look for a teacup with faded roses.

Pour your tea gently, and listen closelyâ€¦

ðŸŒ¿ The garden might just whisper back. ðŸŒ¿`,
  category: "Fantasy",
  image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTY-7rQqkw0C4MRdWJIa7Xt3_82jH10vlE4tw&s"
},

  {
  id: 5,
  title: "Bunnyâ€™s Big Hug",
  text: `Bunny was no ordinary rabbit. Sure, she had soft white fur, floppy ears, and a bouncy hop â€” but what made her truly special was her heart. It was so full of love, it practically overflowed.
And what did Bunny do with all that love?

She hugged.

Bunny believed a hug could fix anything. Whether it was a rainy morning, a stubbed toe, or a lonely day â€” a Bunny Hugâ„¢ made it better.

One bright spring morning, Bunny woke up under her tulip-leaf blanket, stretched her paws, and twitched her nose.
"Today feels like a hugging day!" she said with a cheerful bounce.

She began her hop through the Whispering Woods.

The first friend she found was Toad, sitting glumly on a lily pad.
â€œWhatâ€™s wrong?â€ Bunny asked.
Toad let out a sigh that made the pond ripple.
â€œI hosted a poetry reading... and no one came,â€ he mumbled. â€œNot even the fireflies.â€
Bunnyâ€™s heart sank. She didnâ€™t say a word â€” just opened her tiny arms and wrapped Toad in a warm, squishy hug.
â€œI would love to hear one of your poems,â€ she whispered.
Toadâ€™s eyes twinkled. He cleared his throat and proudly recited:

â€œA pebble dropped into a stream,  
A ripple wakes a dream.  
If frogs can rhyme and time can fly,  
Why not leap and touch the sky?â€

Bunny clapped. â€œBravo!â€ she cheered.

Next, she found Hedgehog, sniffling beside a pile of leaves.
â€œI lost my favorite pinecone,â€ Hedgehog squeaked. â€œIt was shaped like a little crown.â€
Bunny wrapped her in a gentle hug â€” careful not to get poked â€” and promised, â€œWeâ€™ll find you a new treasure.â€

She continued on, meeting Squirrel trembling on a branch.
â€œI had a bad dream,â€ Squirrel admitted, his tail twitching nervously.
Without hesitation, Bunny climbed up (quite clumsily) and hugged him tight.
â€œYouâ€™re safe now. I promise,â€ she whispered.

Later, she passed Fox, who sat under a tree, holding his paw.
â€œI tripped on a root,â€ Fox said with a wince. â€œMy toeâ€™s all sore.â€
Bunny kissed his paw â€” then hugged him too.

All day long, Bunny spread her hugs like sunshine.

But something wonderful began to happenâ€¦

When Hedgehog found a new pinecone later that afternoon, she ran straight to Bunny to share the news â€” and hugged her.
When Squirrel woke up from his nap, he ran to Bunny and gave her a surprise hug.
Even grumpy Owl flew down from his tree and offered a shy hug, saying, â€œYou make the forest feel lighter.â€

By sunset, laughter echoed through the trees. Animals giggled, shared stories, and snuggled together near the big hollow tree. The forest hadnâ€™t changed much â€” but it felt warmer, brighter, safer.

And when the stars twinkled overhead and Bunny finally yawned, she curled beneath her leaf blanket once again.

This time, she wasnâ€™t alone.

All her friends nestled close â€” arms, wings, paws, and tails wrapped around each other.

And as she drifted off to sleep, Bunny whispered with a smile:

â€œOne hug can change a heart...  
But many hugs?  
They change the world.â€`,
  category: "Friendship",
  image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS3h6SzAfX5ou3b8yPVPCTSwlWcGK8CaAHDSw&s"
},

];

// Fetch saved stories from localStorage
function getSavedStories() {
  return JSON.parse(localStorage.getItem("savedStories") || "[]");
}

// Toggle save/remove a story by ID
function toggleSave(id) {
  let saved = getSavedStories();
  if (saved.includes(id)) {
    saved = saved.filter(sid => sid !== id);
  } else {
    saved.push(id);
  }
  localStorage.setItem("savedStories", JSON.stringify(saved));
}

// Display stories dynamically and allow clicking to navigate to reader.html
function displayStories(stories) {
  const container = document.getElementById("storyContainer");
  container.innerHTML = "";

  if (stories.length === 0) {
    container.innerHTML = "<p style='text-align:center;width:100%'>No stories found ðŸ’”</p>";
    return;
  }

  stories.forEach(story => {
    const card = document.createElement("div");
    card.className = "story-card book-flip";

    const img = document.createElement("img");
    img.src = story.image;
    img.alt = story.title;
    img.className = "story-img";

    const title = document.createElement("h3");
    title.innerText = story.title;

    const preview = document.createElement("p");
    preview.innerText = story.text.slice(0, 60) + "...";

    // âœ… Click to open reader.html with this story
    card.addEventListener("click", () => {
      localStorage.setItem("selectedStory", JSON.stringify(story));
      window.location.href = "reader.html";
    });

    card.appendChild(img);
    card.appendChild(title);
    card.appendChild(preview);

    container.appendChild(card);
  });

  filterStories(); // Enable search filtering
}

// Load stories with optional saved filtering and category filtering
function loadStories(filterSaved = false, category = null) {
  const saved = getSavedStories();
  let toShow = filterSaved
    ? stories.filter(s => saved.includes(s.id))
    : [...stories];

  if (category) {
    toShow = toShow.filter(s => s.category === category);
  }

  displayStories(toShow);
}

// Create category buttons dynamically
function createCategoryButtons() {
  const categories = [...new Set(stories.map(s => s.category))];
  const nav = document.querySelector("nav");

  // Clear old buttons
  nav.innerHTML = '';

  categories.forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.innerText = cat;
    btn.onclick = () => loadStories(false, cat);
    nav.appendChild(btn);
  });

  const allBtn = document.createElement("button");
  allBtn.className = "btn";
  allBtn.innerText = "All";
  allBtn.onclick = () => loadStories(false, null);
  nav.appendChild(allBtn);
}

// Filter story cards based on search input
function filterStories() {
  const search = document.getElementById("searchInput")?.value.toLowerCase() || "";
  const cards = document.querySelectorAll(".story-card");

  cards.forEach(card => {
    const title = card.querySelector("h3").innerText.toLowerCase();
    const content = card.querySelector("p").innerText.toLowerCase();
    const match = title.includes(search) || content.includes(search);
    card.style.display = match ? "block" : "none";
  });
}

// On page load
window.onload = () => {
  if (window.location.pathname.includes("library.html")) {
    loadStories(true);
  } else if (window.location.pathname.includes("stories.html")) {
    createCategoryButtons();
    loadStories(false);
  } else if (window.location.pathname.includes("reader.html")) {
    renderReader();
  }
};

// Reader Page: Render selected story
function renderReader() {
  const story = JSON.parse(localStorage.getItem("selectedStory"));
  if (!story) return;

  const title = document.getElementById("readerTitle");
  const image = document.getElementById("readerImage");
  const text = document.getElementById("readerText");

  title.innerText = story.title;
  image.src = story.image;
  text.innerHTML = "";

  let i = 0;
  const speed = 25;
  const fullText = story.text;

  function typeWriter() {
    if (i < fullText.length) {
      const char = fullText.charAt(i);
      text.innerHTML += char === "\n" ? "<br>" : char;
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  typeWriter();
}
